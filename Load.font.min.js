/*
    Load.fonts v1.0.0 – 21 August, 2012

    (c) Amsul Naeem, 2012
    Licensed under MIT ("expat" flavour) license.
    Hosted on http://github.com/amsul/Load.fonts

    A fork of Font.js v2012.01.25: https://github.com/Pomax/Font.js

    This library adds Font objects to the general pool
    of available JavaScript objects, so that you can load
    fonts through a JavaScript object similar to loading
    images through a new Image() object.

    Load.fonts is compatible with all browsers that support
    <canvas> and Object.defineProperty - This includes
    all versions of Firefox, Chrome, Opera, IE and Safari
    that were 'current' (Firefox 9, Chrome 16, Opera 11.6,
    IE9, Safari 5.1) at the time Font.js was released.

    Load.fonts will not work on IE8 or below due to the lack
    of Object.defineProperty - I recommend using the
    solution outlined in http://ie6update.com/ for websites
    that are not corporate intranet sites, because as a home
    user you have no excuse not to have upgraded to Internet
    Explorer 9 yet, or simply not using Internet Explorer if
    you're still using Windows XP. If you have friends or
    family that still use IE8 or below: intervene.

    You may remove every line in this header except for
    the first block of four lines, for the purposes of
    saving space and minification. If minification strips
    the header, you'll have to paste that paragraph back in.

    Issue tracker: https://github.com/amsul/Load.fonts/issues

*/

(function(){var a;a=(function(){var b;function c(){}b={};b.checkSupport=function(){var e,d;e=(function(){var j,f,h,i;try{f=new Uint8Array(1);return}catch(g){return}i=function(l,k){return this.slice(l,k)};h=function(o,n){var l,m,k;if(arguments.length<2){n=0}for(m=0,k=o.length;m<k;m++){l=o[m];this[n]=l&255;n+=1}};j=function(m){var l,k;if(typeof m==="number"){k=new Array(m);l=0;while(m>l){k[l]=0;l+=1}}else{k=m.slice(0)}k.subarray=i;k.buffer=k;k.byteLength=k.length;k.set=h;if(typeof m==="object"&&m.buffer){k.buffer=m.buffer}return k};window.Uint8Array=j;window.Uint32Array=j;window.Int32Array=j})();d=(function(){var f;if(window.opera||("response" in XMLHttpRequest.prototype)||("mozResponseArrayBuffer" in XMLHttpRequest.prototype)||("mozResponse" in XMLHttpRequest.prototype)||("responseArrayBuffer" in XMLHttpRequest.prototype)){return}if(window.VBArray){f=function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}}else{f=function(){return this.responseBody}}try{Object.defineProperty(XMLHttpRequest.prototype,"response",{get:f})}catch(g){}})();if(!window.btoa){window.btoa=function(p){var x,l,w,n,q,v,u,t,s,o,k,j,g,f,m;k=void 0;j=void 0;g=void 0;w=void 0;v=void 0;u=void 0;t=void 0;s=void 0;l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o=0;x=0;n="";m=[];if(!p){return p}do{k=p.charCodeAt(o++);j=p.charCodeAt(o++);g=p.charCodeAt(o++);w=k<<16|j<<8|g;v=w>>18&63;u=w>>12&63;t=w>>6&63;s=w&63;m[x++]=l.charAt(v)+l.charAt(u)+l.charAt(t)+l.charAt(s)}while(o<p.length);n=m.join("");f=p.length%3;q=f?n.slice(0,f-3):n;return(f?n.slice(0,f-3):n)+"===".slice(f||3)}}return b};b.initialize=(function(){b.checkSupport();if(!Object.defineProperty){throw"Load.font.js requires Object.defineProperty, which this browser does not support."}if(!document.createElement("canvas").getContext){throw"Load.font.js requires <canvas> and the Canvas2D API, which this browser does not support."}c.prototype.fontFamily="lfjs"+(999999*Math.random()|0);c.prototype.url="";c.prototype.format="";c.prototype.data="";c.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==";c.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400};c.prototype.systemfont=false;c.prototype.loaded=false;c.prototype.onload=function(){};c.prototype.onerror=function(){};c.prototype.canvas=false;c.prototype.context=false;c.prototype.validate=function(j,h,l,f,i){var k,e,g;if(i!==false&&i<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}e=document.defaultView.getComputedStyle(j,"");g=e.getPropertyValue("width").replace("px","");if(g>0){document.head.removeChild(h);document.body.removeChild(j);this.loaded=true;this.onload()}else{k=function(){f.validate(j,h,l,f,i===false?false:i-50)};setTimeout(k,50)}};c.prototype.ondownloaded=function(){var p,g,E,y,l,D,H,M,w,J,G,F,m,C,x,z,B,o,s,I,v,k,q,f,h,N,A,t,r,K,L,u,n,j;y=function(e){return String.fromCharCode(e)};l=function(O){var i,e;if(O<256){return y(0)+y(O)}i=O>>8;e=O&255;return y(i)+y(e)};w=function(e){if(e<0){e=4294967295+e+1}return parseInt(e,10).toString(16)};u=function(i,e){return 256*i+e};z=function(O,e){var i,P;i=O>>7===1;O=O&127;P=256*O+e;if(!i){return P}return P-32768};K=function(P,O,i,e){return 16777216*P+65536*O+256*i+e};x=function(e){this.onerror(e)};r=y(0)+y(1)+y(0)+y(0);p="OTTO";M=this.data;n=y(M[0])+y(M[1])+y(M[2])+y(M[3]);s=n===r;o=s?false:n===p;if(s){this.format="truetype"}else{if(o){this.format="opentype"}else{x("Error: file at "+this.url+" cannot be interpreted as OpenType font.")}}v=u(M[4],M[5]);A=12;m=A+16*v;t={};H=function(i){var e;e=y(M[i])+y(M[i+1])+y(M[i+2])+y(M[i+3]);t[e]={name:e,checksum:K(M[i+4],M[i+5],M[i+6],M[i+7]),offset:K(M[i+8],M[i+9],M[i+10],M[i+11]),length:K(M[i+12],M[i+13],M[i+14],M[i+15])}};for(f=j=A;j<m;f=j+=16){H(f)}E=function(e){if(!t[e]){x("Error: font is missing the required OpenType '"+e+"' table.");return false}return e};N=E("head");if(N===false){return}f=t[N].offset;t[N].version=""+M[f]+M[f+1]+M[f+2]+M[f+3];L=u(M[f+18],M[f+19]);this.metrics.quadsize=L;N=E("hhea");if(N===false){return}f=t[N].offset;t[N].version=""+M[f]+M[f+1]+M[f+2]+M[f+3];this.metrics.ascent=z(M[f+4],M[f+5])/L;this.metrics.descent=z(M[f+6],M[f+7])/L;this.metrics.leading=z(M[f+8],M[f+9])/L;N=E("OS/2");if(N===false){return}f=t[N].offset;t[N].version=""+M[f]+M[f+1];this.metrics.weightclass=u(M[f+4],M[f+5]);N=E("cmap");if(N===false){return}f=t[N].offset;t[N].version=""+M[f]+M[f+1];v=u(M[f+2],M[f+3]);D=false;g=function(){var e,P,i,O;O=f+4+F*8;i=u(M[O],M[O+1]);e=u(M[O+2],M[O+3]);P=K(M[O+4],M[O+5],M[O+6],M[O+7]);if(i===3&&e===1){D=P}};F=0;while(F<v){g();F+=1}k="A";if(D!==false){f+=D;n=u(M[f],M[f+1]);if(n===4){h=u(M[f+6],M[f+7])/2;q=function(e){return[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(e)===-1};B=f+14;G=f+14+2*h;C=false;while(B<G){C=u(M[B],M[B+1]);if(q(C)){break}C=false;B+=2}if(C!==false){k=String.fromCharCode(C);J=-(C-1)+65536;I=btoa(window.unescape(encodeURIComponent(y(0)+l(C)+l(65535)+l(0)+l(C)+l(65535)+l(J)+l(1))));this.base64=this.base64.substring(0,380)+I+this.base64.substring(380+I.length)}}}this.bootstrapValidation(k,false)};c.prototype.bootstrapValidation=function(f,k){var h,g,m,j,l,p,o,n,e,i;j=function(q){return this.onerror(q)};e=this.fontFamily+" testfont";i=document.createElement("style");i.setAttribute("type","text/css");i.innerHTML="@font-face {\n"+"font-family: '"+e+"';\n"+"src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n"+"format('truetype');}";document.head.appendChild(i);n=false;if(!this.systemfont){n=this.toStyleNode();document.head.appendChild(n)}p=document.createElement("p");p.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;";p.style.fontFamily="'"+this.fontFamily+"', '"+e+"'";p.innerHTML=f+f+f+f+f+f+f+f+f+f;document.body.appendChild(p);if(!document.defaultView.getComputedStyle){this.onload();j("Error: document.defaultView.getComputedStyle is not supported by this browser.\n"+"Consequently, Font.onload() cannot be trusted.")}else{o=this.systemfont?1000:this.metrics.quadsize;h=document.createElement("canvas");h.width=o;h.height=o;this.canvas=h;g=h.getContext("2d");g.font="1em '"+this.fontFamily+"'";g.fillStyle="white";g.fillRect(-1,-1,o+2,o+2);g.fillStyle="black";g.fillText("test text",50,o/2);this.context=g;l=this;m=function(){l.validate(p,i,n,l,k)};setTimeout(m,50)}};c.prototype.processSystemFont=function(){this.systemfont=true;this.metrics=false;this.bootstrapValidation("A",1000)};c.prototype.loadFont=function(){var e,f;e=this;if(this.url.indexOf(".")===-1){setTimeout(e.processSystemFont(),10);return}f=new XMLHttpRequest();f.open("GET",e.url,true);f.responseType="arraybuffer";f.onload=function(g){var h;h=f.response;if(h){e.data=new Uint8Array(h);e.ondownloaded()}else{e.onerror("Error downloading font resource from "+e.url)}};f.send(null)};c.prototype.styleNode=false;c.prototype.toStyleNode=function(){if(this.styleNode){return this.styleNode}this.styleNode=document.createElement("style");this.styleNode.type="text/css";this.styleNode.innerHTML="@font-face {\n"+"font-family: '"+this.fontFamily+"';\n"+"src: url('"+this.url+"') format('"+this.format+"');\n"+"}";return this.styleNode};c.prototype.measureText=function(e,m){var g,j,k,h,l,f;g=function(i){return this.onerror(i)};if(!this.loaded){g("measureText() was called while the font was not yet loaded");return false}this.context.font=m+"px '"+this.fontFamily+"'";k=this.context.measureText(e);k.fontsize=m;k.ascent=0;k.descent=0;k.bounds={minx:0,maxx:k.width,miny:0,maxy:0};k.height=0;f=[];h=k.width/this.metrics.quadsize;if(h<=1){f.push(e)}else{f.push(e)}j=0;l=f.length;while(j<l){this.measureSegment(f[j],m,k);j+=1}return k};c.prototype.measureSegment=function(q,f,G){var r,C,A,k,F,M,z,K,I,H,u,n,J,l,L,m,e,y,o,t,E,D,p,v,s,x,g,B;z=function(h,i){return document.defaultView.getComputedStyle(h,null).getPropertyValue(i)};u=document.createElement("div");u.style.position="absolute";u.style.opacity=0;u.style.font=f+"px '"+this.fontFamily+"'";e=10;u.innerHTML=q;I=1;C=function(){u.innerHTML+="<br>"+q};while(I<e){C();I+=1}document.body.appendChild(u);G.leading=1.2*f;n=z(u,"height");n=n.replace("px","");if(n>=f*e){G.leading=(n/e)|0}document.body.removeChild(u);if(/^\s*$/.test(q)){return G}k=this.canvas;F=this.context;t=this.systemfont?1000:this.metrics.quadsize;v=t;K=t;A=t/2;y=50;g=(t-G.width)/2;if(g!==(g|0)){g=g|0}F.fillStyle="white";F.fillRect(-y,-y,v+2*y,K+2*y);F.fillStyle="black";F.fillText(q,g,A);D=(G.width+y)|0;E=4*f;x=g-y/2;B=A-E/2;o=F.getImageData(x,B,D,E).data;I=0;H=0;s=D*4;J=o.length;L=E/2;while(++I<J&&o[I]===255){continue}r=(I/s)|0;I=J-1;while(--I>0&&o[I]===255){continue}M=(I/s)|0;I=0;H=0;while(H<D&&o[I]===255){I+=s;if(I>=J){H++;I=(I-J)+4}}m=H;p=1;I=J-3;H=0;while(H<D&&o[I]===255){I-=s;if(I<0){H++;I=(J-3)-(p++)*4}}l=D-H;G.ascent=L-r;G.descent=M-L;G.bounds={minx:m-(y/2),maxx:l-(y/2),miny:-G.descent,maxy:G.ascent};G.height=1+(M-r);return G};try{Object.defineProperty(c.prototype,"src",{set:function(e){this.url=e;return this.loadFont()}})}catch(d){}window.Font=c;return b})();return c})()}).call(this);